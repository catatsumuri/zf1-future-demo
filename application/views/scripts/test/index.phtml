<div class="page-header">
    <h1>Database Connectivity Test</h1>
    <p class="text-muted">Verify the application can reach the MySQL service defined in Docker Compose.</p>
</div>

<?php if ($this->isConnected): ?>
    <div class="alert alert-success" role="alert">
        <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
        <?php echo $this->escape($this->message); ?>
    </div>
    <dl class="dl-horizontal">
        <dt>MySQL Version</dt>
        <dd><?php echo $this->escape($this->version); ?></dd>
    </dl>
<?php else: ?>
    <div class="alert alert-danger" role="alert">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
        <?php echo $this->escape($this->message); ?>
    </div>
    <?php if (isset($this->error)): ?>
        <div class="alert alert-warning" role="alert">
            <strong>Error detail:</strong>
            <pre style="margin: 8px 0 0; background: transparent; border: 0; padding: 0;"><?php echo $this->escape($this->error); ?></pre>
        </div>
    <?php endif; ?>
<?php endif; ?>

<p class="text-muted">Provide credentials through environment variables such as <code>DB_HOST</code>, <code>DB_USER</code>, <code>DB_PASSWORD</code>, and <code>DB_NAME</code> before starting the stack.</p>

<?php
$connectionParams = $this->connectionParams ?? [];

if (!empty($connectionParams)) {
    $sortedConnectionParams = $connectionParams;
    ksort($sortedConnectionParams);
}

$environmentVariables = $this->environmentVariables ?? [];

if (!empty($environmentVariables)) {
    ksort($environmentVariables);
}
?>

<?php if (!empty($connectionParams)): ?>
    <h2>Connection Parameters</h2>
    <table class="table table-striped table-bordered table-condensed">
        <thead>
            <tr>
                <th>Key</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
        <?php foreach ($sortedConnectionParams as $key => $value): ?>
            <tr>
                <td><?php echo $this->escape($key); ?></td>
                <td><code><?php echo $this->escape((string) $value); ?></code></td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
<?php endif; ?>

<?php if (!empty($environmentVariables)): ?>
    <h2>Environment Variables</h2>
    <table class="table table-striped table-bordered table-condensed">
        <thead>
            <tr>
                <th>Name</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
        <?php foreach ($environmentVariables as $name => $value): ?>
            <tr>
                <td><?php echo $this->escape($name); ?></td>
                <td><code><?php echo $this->escape((string) $value); ?></code></td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
<?php endif; ?>
